{% extends 'base.html' %}
{% load static %}
{% block titulo %} Perfil | RecycleByte {% endblock %}
{% block bg %}
    style="background-image: url('{% static 'assets/bg3.png' %}'); background-size: cover; background-position: center; background-repeat: no-repeat;"
{% endblock %}

{% block coluna_esquerda %}
    <h3>Bem vindo </h3>
    <h2 style="color:blueviolet;">{{username}}</h2>
    <div class="text-center">
        <img src="{% static 'assets/profile1.png' %}" alt="Foto do perfil" class="bg-secondary" style="width: 100%; border-radius: 50%; border: 5px solid;">
        <a href="{% url 'profile' conteudo='profile_edit' %}" class="nav-link" style="background-color: rgb(255, 177, 60);">Editar Perfil</a>
    </div>

    <div class="container mt-3">
        <p>Barra de Progresso</p>
        <div class="progress" style="height: 2vh;">
            <div
                id="progress-bar"
                class="progress-bar"
                role="progressbar"
                style="width: {{ xp }}%;"
                aria-valuenow="{{ xp }}"
                aria-valuemin="0"
                aria-valuemax="100">
            </div>
        </div>
        <h2 id="level-counter" class="mt-3">Nível: {{ nivel }}</h2>
    </div>
    
    <!-- Botão para adicionar reciclagem -->
    <form action="{% url 'increase_xp' %}" method="post" id="xp-form">
        {% csrf_token %}
        <button type="submit" id="increase-btn" class="btn btn-success m-4 btn-lg rounded-5">
            Adicionar Reciclagem
        </button>
    </form>
    
    <!-- Botão para sair -->
    <a class="btn btn-warning me-3 btn-lg mt-auto m-4 rounded-5" href="{% url 'logout' %}">Sair</a>
    
    <!-- Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const progressBar = document.getElementById('progress-bar');
            const increaseBtn = document.getElementById('increase-btn');
            const levelCounter = document.getElementById('level-counter');
            const xpForm = document.getElementById('xp-form');
    
            let currentLevel = {{ nivel|default:0 }};
            let currentXP = {{ xp|default:0 }};
    
            // Atualiza o contador de nível e a barra de progresso com base nos valores iniciais
            levelCounter.textContent = 'Nível: ' + currentLevel;
            progressBar.style.width = currentXP + '%';
    
            increaseBtn.addEventListener('click', function(event) {
                event.preventDefault();  // Impede o comportamento padrão do botão (enviar formulário imediatamente)
    
                // Envia o formulário para a view que irá incrementar o XP
                xpForm.submit();
            });
        });
    </script>
{% endblock %}

{% block conteudo %}
<div class="coluna-central">
    <nav class="navbar-profile">
        <a href="{% url 'profile' conteudo='resumo' %}" class="nav-link">Resumo</a>
        <a href="{% url 'profile' conteudo='loja' %}" class="nav-link">Loja</a>
        <a href="{% url 'profile' conteudo='ranking' %}" class="nav-link">Ranking</a>
        <a href="{% url 'profile' conteudo='mapa' %}" class="nav-link">Mapa</a>
    </nav>

    {% if conteudo == 'resumo' %}
        {% include 'profile_tabs/resumo.html' %}
    {% elif conteudo == 'loja' %}
        {% include 'profile_tabs/loja.html' %}
    {% elif conteudo == 'ranking' %}
        {% include 'profile_tabs/ranking.html' %}
    {% elif conteudo == 'mapa' %}
        {% include 'profile_tabs/mapa-profile.html' %}
    {% elif conteudo == 'profile_edit' %}
        {% include 'profile_tabs/profile_edit.html' %}
    {% endif %}
</div>
{% endblock %}

{% block coluna_direita %}
    <h3>Conquistas</h3>
    <div>
        <div class="d-flex justify-content-center">
            <img src="{% static 'assets/badges/badge-quest.png' %}" alt="" width="80px">
            <img src="{% static 'assets/badges/badge-quest.png' %}" alt="" width="80px">
            <img src="{% static 'assets/badges/badge-quest.png' %}" alt="" width="80px">
        </div>
        <div class="d-flex justify-content-center">
            <img src="{% static 'assets/badges/badge-quest.png' %}" alt="" width="80px">
            <img src="{% static 'assets/badges/badge-quest.png' %}" alt="" width="80px">
            <img src="{% static 'assets/badges/badge-quest.png' %}" alt="" width="80px">
        </div>
        <div class="d-flex justify-content-center">
            <img src="{% static 'assets/badges/badge-quest.png' %}" alt="" width="80px">
            <img src="{% static 'assets/badges/badge-quest.png' %}" alt="" width="80px">
            <img src="{% static 'assets/badges/badge-quest.png' %}" alt="" width="80px">
        </div>
        <div class="d-flex justify-content-center">
            <img src="{% static 'assets/badges/badge-quest.png' %}" alt="" width="80px">
            <img src="{% static 'assets/badges/badge-quest.png' %}" alt="" width="80px">
            <img src="{% static 'assets/badges/badge-quest.png' %}" alt="" width="80px">
        </div>
        <div class="d-flex justify-content-center">
            <img src="{% static 'assets/badges/badge-quest.png' %}" alt="" width="80px">
            <img src="{% static 'assets/badges/badge-quest.png' %}" alt="" width="80px">
            <img src="{% static 'assets/badges/badge-quest.png' %}" alt="" width="80px">
        </div>
    </div>
{% endblock %}
